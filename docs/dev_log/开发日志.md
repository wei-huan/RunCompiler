# 开发日志

理想
7-2 -- 7-3 做好符号表
7-3 -- 7-5 生成 LLVM IR
7-5 -- 7-10 跑起来

现实
7-2 搞好 Log
7-2 -- 7-4 做好符号表
7-4 -- 7-14 生成 LLVM IR
7-14 -- 7-17 完成 mem2reg 和

空了一个多月
现在目标是完成后端能完成一个汇编代码的生成

11月3号完成MacOS环境适配


### 11月10
正式开工
问题：发现功能测试52_scope.sy有大问题，无法支持返回分支内正确返回(return), 可能也无法支持多return的函数

52_scope 59_sort_test5 61_sort_test7 62_percolation 66_exgcd 75_max_flow 77_substr

### 11月13日
找到解决方案：多return需要在进入函数后分配一个返回变量，多返回分支就把返回值写入返回变量然后再跳转到一个地方统一返回，类似clang llvm

新问题：不支持多层循环，需要改进

### 11月20日
改进精简了分支逻辑，减少无效变量和无效操作

### 11月21日
56_sort_test2.sy 57_sort_test3.sy .. 发现有bug, 是在LVal中
61_sort_test7.sy 发现有bug, 是出现在打印代码后
```ibc++abi: terminating with uncaught exception of type std::bad_optional_access: bad_optional_access```
改进精简了循环的分支逻辑，减少无效变量和无效操作


### 11月28日
添加日志输出重定向和输入设定等级

### 11月29日
添加自动化测试脚本方便测试
改掉嵌套内返回逻辑, 完成一半, 还差分支语句中的多条出口冲突

### 11月30日
嵌套内返回逻辑完成
添加循环内直接返回用例
添加sy转c文件脚本

### 12月1日
添加库函数putch getch这些
添加遍历遍历文件夹的循环

### 12月2日
修改11月21日发现的bug

### 12月3日
添加多层循环测试用例，包括continue break return

### 12月26日
完成了部分库函数注册功能
修复常量声明多占用一个ssa id问题

### 12月31日
添加了几个自动化批量测试脚本

发现的问题
1. llvm生成的中间代码不是针对32位arm v7的
2. 54_hidden_var.sy生成的ir中 if(a) 没有load之后没有icmp操作
3. 54_hidden_var.sy生成的ir中 加载全局数组地址getelementptr没用全局符合@b，用的是ssa id
4. 54_hidden_var.sy生成的ir中 函数体内的数组初始化代码没有生成ir
5. ir中没有declare使用的库函数的声明


### 2023年1月1日
比对了一遍1-54的测试文件生成的自己的ir和llvm的ir，发现了以下一些问题。

修复：
1. 54_hidden_var.sy生成的ir中 加载全局数组地址getelementptr的gencode改成全局符合@b

发现的问题
1. 04_arr_defn3.sy代码中函数体内没有数据初始化
2. 40_unary_op.sy 中if (+-!!!a)生成的代码逻辑中最后load之后缺少icmp
3. 50_short_circuit.sy 中 if(i <= 100 || func(i)) 中func(i)之后没有icmp
   
TODO:
1. 没用到的初始返回值删除
2. 分支标号顺序有点迂回，不方便检查，需要根据代码执行顺序调整

### 2023年02月25日
编译器初始化完善，包括检查文件和文件夹合法性。还增加了IR输出重定向到特定文件中。

### 2023年02月26日
完成了数组值的初始化。

### 2023年03月04日
完成了一部分数组指针的支持。

### 2023年03月05日
基本完成数组指针的支持。

目前存在的问题
1. 40_unary_op.sy 中if (+-!!!a)生成的代码逻辑中最后load之后缺少icmp
2. 生成IR中函数定义中数组指针的类型错误
3. 95_float.sy 不支持浮点数
4. 94_nested_loops.sy 不支持深层的break 和 continue 

### 2023年03月07日
修复了 4. 94_nested_loops.sy 不支持深层的break 和 continue 的bug

目前存在的问题
1. 40_unary_op.sy 中if (+-!!!a)生成的代码逻辑中最后load之后缺少icmp
2. 生成IR中函数定义中数组指针的类型错误
3. 95_float.sy 不支持浮点数
